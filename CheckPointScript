local checkpointsFolder = workspace.Checkpoints

game.Players.PlayerAdded:Connect(function(plr)
	local leaderstats = Instance.new("Folder", plr)
	leaderstats.Name = "leaderstats"
	local stageValue = Instance.new("IntValue", leaderstats)
	stageValue.Name = "Stage"
	stageValue.Value = 1

	plr.CharacterAdded:Connect(function(char)
		task.wait()
		if stageValue.Value > 1 then
			local checkpoint = checkpointsFolder:FindFirstChild(tostring(stageValue.Value - 1))
			if checkpoint then
				char:MoveTo(checkpoint.Position)
			end
		end
	end)
end)

local children = checkpointsFolder:GetChildren()
for i = 1, #children do
	local v = children[i]
	v.Touched:Connect(function(hit)
		local humanoid = hit.Parent:FindFirstChild("Humanoid")
		if humanoid then
			local char = hit.Parent
			local plr = game.Players:GetPlayerFromCharacter(char)
			if plr and plr:FindFirstChild("leaderstats") and plr.leaderstats:FindFirstChild("Stage") then
				local stageValue = plr.leaderstats.Stage
				if tonumber(v.Name) == stageValue.Value then
					stageValue.Value = stageValue.Value + 1
				end
			end
		end
	end)
end

